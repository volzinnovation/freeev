<!DOCTYPE html>
<html>
<head>
	
	<title>freeev.de - Eine Karte der kostenfreien deutschen Ladesäulen</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
    <!-- Apple specific -->
	<link rel="apple-touch-icon" href="touch-icon.png">
    <meta name="apple-mobile-web-app-title" content="Freeev.de">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <link href="https://cdn.materialdesignicons.com/1.3.41/css/materialdesignicons.min.css" rel="stylesheet" type="text/css" />

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script> 
    <script src="Leaflet.Icon.Glyph.js"/>
    <style>
 		html, body {
 			height: 100%;
 			margin: 0;
 		}
 		#map {
 			width: 600px;
 			height: 400px;
 		}
 	</style>

     <style>html, body { height:100%; padding: 0; margin: 0; } #map { height: 100%; width: 100vw; }</style>
</head>
<body>

<div id='map'></div>

<script>
	var map = L.map('map', { "tap": false });

    L.tileLayer(
                "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                {"attribution": "App \u0026copy; \u003ca href=\"http://www.raphaelvolz.de\"\u003eRaphael Volz\u003c/a\u003e Daten der Ladenstationen aus \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eBundesnetzagentur.de\u003c/a\u003e  und \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, unter \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
            ).addTo(map);

	function onLocationFound(e) {
		var radius = e.accuracy / 2;
		L.circle(e.latlng, radius).addTo(map);
	}

	function onLocationError(e) {
		alert(e.message);
	}
/*
    async function load_shapefile() {
      let url = 'https://raw.githubusercontent.com/volzinnovation/freeev/main/free_chargers_DE.geojson';
      const response = await fetch(url)
      const shape_obj = await response.json();
      console.log(shape_obj);
      return shape_obj;
    }

    load_shapefile().then(L.geoJson).then(map.addLayer.bind(map));
  */
    
    function onMapClick(b,l) {
        console.log("Clickery click.")
        window.location = "http://maps.apple.com/?ll=" + b + "," + l
        
    }
    function onEachFeature(feature, layer) {
    if (feature.properties && feature.properties.Betreiber) {
        layer.bindPopup('<a href=\"https://www.google.com/maps/search/?api=1&query=' + feature.geometry.coordinates[1] + ',' + feature.geometry.coordinates[0] + '\">' + feature.properties.Betreiber + ' (' + feature.properties.Max_KW + ')</a>').openPopup();
        layer.title=feature.properties.Betreiber;
    }
    // layer.on('click', onMapClick(feature.properties.Breitengrad, feature.properties.Längengrad));
}
    function load(url) {
    fetch(url)
.then(function(response) {
return response.json();
})
.then(function(data) {
L.geoJSON(data, {
  onEachFeature: onEachFeature
}).addTo(map);
});
    }
    
    load("https://raw.githubusercontent.com/volzinnovation/freeev/main/free_chargers_DE.geojson");
    load("https://raw.githubusercontent.com/volzinnovation/freeev/main/free_chargers_OSM.geojson");
    
	map.on('locationfound', onLocationFound);
	map.on('locationerror', onLocationError);
	map.locate({setView: true, maxZoom: 16});
	
	L.marker([-20,-20], {icon: L.icon.glyph({ prefix: 'mdi', glyph: 'ev-plug-type2' }) }).addTo(map);
	
</script>



</body>
</html>
